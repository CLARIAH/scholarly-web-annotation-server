# RDFa Annotation Client

For the RDFa Annotation Client and its communicating with the server (e.g. Alexandria) we need to establish a data model for the annotations. The idea is to base this on the [W3C Web Annotation Model](https://www.w3.org/TR/annotation-model/#web-annotation-framework).



## Basic model
The most basic target is an entire resource, such as a single van Gogh letter.

```json
{
  "@context": "http://www.w3.org/ns/anno.jsonld",
  "created": 1484229754,
  "body": [
    {
      "vocabulary": "DBpedia",
      "value": "Communication",
      "type": "Classification",
      "id": "http://dbpedia.org/resource/Communication"
    }
  ],
  "motivation": "classifying",
  "creator": "marijn",
  "type": "Annotation",
  "target": [
    {
      "type": "Text",
      "source": "urn:vangogh:let001"
    }
  ],
  "id": "urn:uuid:e9d01a37-9dca-4f96-bc6a-5c44012d6e9e"
}
```

Some discussion points:

+ the `created` is generated by the annotation server. For testing purposes I'm using seconds since epoch, but Alexandria probably has a different format. 
+ In the body I've added a few extra properties, i.e. `type`, `value` and `vocabulary` so that the annotation describes itself more (easier to interpret) and the info can be displayed to the user without needing to do a DBpedia lookup.
+ The motivation `classifying` is taken from the official W3C list of motivations. I would prefer to call this property `task` since that is what it is. It's not a motivation, i.e., it doesn't say why or in what context I'm classifying the target. 


## Fragment selector
When the annotation targets a resource that is part of a larger resource, a [fragment selector](https://www.w3.org/TR/annotation-model/#fragment-selector) is used to refine the target. 

```json
{
  "@context": "http://www.w3.org/ns/anno.jsonld",
  "created": 1483949925,
  "body": [
    {
      "vocabulary": "DBpedia",
      "value": "Theo van Gogh (art dealer)",
      "type": "Classification",
      "id": "http://dbpedia.org/resource/Theo_van_Gogh_(art_dealer)"
    }
  ],
  "motivation": "classifying",
  "creator": "marijn",
  "type": "Annotation",
  "target": [
    {
      "type": "Text",
      "source": "urn:vangogh:let001",
      "selector": {
        "conformsTo": "http://tools.ietf.org/rfc/rfc3870",
        "value": "urn:vangogh:let001.receiver",
        "type": "FragmentSelector"
      }
    }
  ],
  "id": "urn:uuid:8f62be7d-de56-464b-8d9a-5fb0b69fc00b"
}
```

## Text selectors
Instead of selecting a fragment of the resource as target, a user can also select a text fragment as the target. There are two options for text selectors:

1. [text position selector](https://www.w3.org/TR/annotation-model/#text-quote-selector): represents the target through the start and end offsets of the selected text in the resource, e.g. start at character offset 76, end at character offset 84.
2. [text quote selector](https://www.w3.org/TR/annotation-model/#text-position-selector): represents the target through the string of selected text, in combination with short strings before and after it to provide context.

#### Text position selector
```json
{
  "@context": "http://www.w3.org/ns/anno.jsonld",
  "created": 1483959766,
  "body": [
    {
      "vocabulary": "DBpedia",
      "value": "September 29",
      "type": "Classification",
      "id": "http://dbpedia.org/resource/September_29"
    }
  ],
  "motivation": "classifying",
  "creator": "marijn",
  "type": "Annotation",
  "target": [
    {
      "type": "Text",
      "source": "urn:vangogh:let001",
      "selector": {
         "start": 164,
         "type": "TextPositionSelector",
         "end": 176
      }
    }
  ],
  "id": "urn:uuid:3a006d50-15c9-4647-b325-77e6bbb24ad5"
}
```

#### Text quote selector

```json
{
  "@context": "http://www.w3.org/ns/anno.jsonld",
  "created": 1484230981,
  "body": [
    {
      "vocabulary": "DBpedia",
      "value": "September 29",
      "type": "Classification",
      "id": "http://dbpedia.org/resource/September_29"
    }
  ],
  "motivation": "classifying",
  "creator": "marijn",
  "type": "Annotation",
  "target": [
    {
      "type": "Text",
      "source": "urn:vangogh:let001",
      "selector": {
        "prefix": ". The Hague, Sunday, ",
        "suffix": " 1872\n\nSource status:",
        "type": "TextQuoteSelector",
        "exact": "29 September"
      }
    }
  ],
  "id": "urn:uuid:9e808982-33ad-45b4-859f-e385352ca6cd"
}
```


## Combining fragment and text selectors

It is also possible that the target is a selected text fragment that is part of sub-resource of the whole or top-level resource, e.g. a passage (text selection) in a paragraph (sub-resource) in a letter (top-level resource). 

In that case [selector refinement](https://www.w3.org/TR/annotation-model/#refinement-of-selection) is used. In the above case, a `FragmentSelector` is `refinedBy` a `TextPositionSelector` and/or a `TextQuoteSelector`. The annotation below targets the passage *droppeltjes* within the 4th `paragraph` of the `letter`:

```json
{
  "@context": "http://www.w3.org/ns/anno.jsonld",
  "created": 1484220285,
  "body": [
    {
      "vocabulary": "DBpedia",
      "value": "Precipitation (meteorology)",
      "type": "Classification",
      "id": "http://dbpedia.org/resource/Precipitation_(meteorology)"
    }
  ],
  "motivation": "classifying",
  "creator": "marijn",
  "type": "Annotation",
  "target": [
    {
      "type": "Text",
      "source": "urn:vangogh:let001",
      "selector": {
        "conformsTo": "http://tools.ietf.org/rfc/rfc3870",
        "value": "urn:vangogh:let001:p.4",
        "type": "FragmentSelector",
        "refinedBy": [
          {
            "prefix": "had, en tusschen de ",
            "suffix": " door toch nog al ee",
            "type": "TextQuoteSelector",
            "exact": "droppeltjes"
          }
        ]
      }
    }
  ],
  "id": "urn:uuid:46c8fd5f-d038-497d-a7a3-1814b8d65201"
}
```

## Improving robustness: combining text position and text quote selection

When using `refinedBy` in the W3C model, it is possible to use multiple refinements to indicate the same target. That is, all refinement selectors should represent the same target. 

The annotation below combines `TextPositionSelector` and `TextQuoteSelector` representing the same passage *droppeltjes*:

```json
{
  "@context": "http://www.w3.org/ns/anno.jsonld",
  "created": 1484220285,
  "body": [
    {
      "vocabulary": "DBpedia",
      "value": "Precipitation (meteorology)",
      "type": "Classification",
      "id": "http://dbpedia.org/resource/Precipitation_(meteorology)"
    }
  ],
  "motivation": "classifying",
  "creator": "marijn",
  "type": "Annotation",
  "target": [
    {
      "type": "Text",
      "source": "urn:vangogh:let001",
      "selector": {
        "conformsTo": "http://tools.ietf.org/rfc/rfc3870",
        "value": "urn:vangogh:let001:p.4",
        "type": "FragmentSelector",
        "refinedBy": [
          {
            "prefix": "had, en tusschen de ",
            "suffix": " door toch nog al ee",
            "type": "TextQuoteSelector",
            "exact": "droppeltjes"
          },
          {
            "start": 54,
            "type": "TextPositionSelector",
            "end": 65
          }
        ]
      }
    }
  ],
  "id": "urn:uuid:46c8fd5f-d038-497d-a7a3-1814b8d65201"
}
```

Discussion points:

+ This allows bootstrapping the alignment between data about the target and the target itself. E.g. with a combination of text position and text quote it is possible to identify changes in how the resource is displayed. If the text in the displayed resource corresponding to the position selector no longer corresponds to the text in the quote selector, the client knows that display has changed and can look for the quoted text nearby the stored positions. 


## Annotating Audiovisual Resources

The same data model can be used to annotate audiovisual resources, as long as they are accompanied by RDFa information, in e.g. a `<div>` element that surrounds the video or the time bar in which the start and end selectors are displayed.

```json
{
  "@context": "http://www.w3.org/ns/anno.jsonld",
  "created": 1484229754,
  "body": [
    {
      "vocabulary": "GTAA",
      "value": "Waterbronnen",
      "type": "Classification",
      "id": "http://data.beeldengeluid.nl/gtaa/28667"
    }
  ],
  "motivation": "classifying",
  "creator": "marijn",
  "type": "Annotation",
  "target": [
    {
      "type": "Video",
      "source": "http://player.vimeo.com/video/110756897",
      "selector": {
        "type": "FragmentSelector",
        "conformsTo": "http://www.w3.org/TR/media-frags/",
        "value": "#t=149.391,188.939"
      }
    }
  ],
  "id": "urn:uuid:e9d01a37-9dca-4f96-bc6a-5c44012d6e9e"
}
```